# macOS UI 版本开发计划

## 项目概述

基于已实现的 CLI 命令行版本，开发一个 macOS 原生 UI 应用，用于获取和展示 Apple Books 的高亮笔记和注释数据。应用将使用 SwiftUI 和 Swift 6.1 构建，遵循现代 Apple 开发最佳实践。

## 目标与范围

### 核心目标
- 提供直观的 UI 界面来查看和管理 Apple Books 高亮笔记
- 保持与 CLI 版本相同的数据获取和处理能力
- 支持导出功能（JSON 格式）
- 为后续集成 Notion 同步功能奠定基础

### 功能范围
- 读取 Apple Books 数据库中的高亮和注释
- 在 UI 中展示书籍列表和对应的高亮内容
- 支持基本的过滤和搜索功能
- 导出数据为 JSON 文件
- 不包含 Notion 集成（将在后续版本中实现）

## 技术架构

### 核心设计原则
- 组合优于继承 - 使用依赖注入
- 接口优于单例 - 支持测试和灵活性
- 显式优于隐式 - 清晰的数据流和依赖关系

### 技术栈
- **语言**: Swift 6.1
- **UI 框架**: SwiftUI (macOS 14+)
- **数据处理**: 原生 SQLite3（与 CLI 版本保持一致）
- **架构模式**: MVVM (Model-View-ViewModel)
- **响应式编程**: Combine

### 项目结构
```
macOS/
├── Models/                 # 数据模型
├── Views/                  # SwiftUI 视图组件
├── ViewModels/             # 视图模型
├── Services/               # 核心服务（数据库访问、数据处理）
├── Utilities/              # 工具类
├── Resources/              # 资源文件
└── App/                    # 应用入口和主结构
```

## MVP 实现计划

### 第一阶段：基础架构搭建 (1-2 天)

#### 任务清单
1. 创建项目文件结构
2. 移植 CLI 中的核心数据模型到 macOS 项目
3. 实现数据库访问服务（复用 CLI 的 SQLite 逻辑）
4. 创建基础的 ViewModel 层
5. 实现简单的主界面展示书籍列表

#### 交付物
- 可运行的 macOS 应用，能够显示书籍列表
- 数据获取逻辑与 CLI 版本保持一致
- 基础的 MVVM 架构

### 第二阶段：核心功能实现 (3-5 天)

#### 任务清单
1. 实现书籍详情视图，展示高亮内容
2. 添加基本的过滤和搜索功能
3. 实现数据导出功能（JSON 格式）
4. 添加状态管理和错误处理
5. 实现书籍和高亮数据的内存模型

#### 交付物
- 完整的书籍和高亮展示界面
- 支持搜索和过滤功能
- 数据导出功能
- 错误处理和用户反馈机制

### 第三阶段：UI/UX 优化 (2-3 天)

#### 任务清单
1. 设计和实现美观的用户界面
2. 添加适当的动画和过渡效果
3. 优化响应式布局适配不同窗口大小
4. 实现暗黑模式支持
5. 添加用户偏好设置（如默认导出路径）

#### 交付物
- 美观、易用的用户界面
- 支持暗黑模式
- 良好的用户体验

### 第四阶段：测试与稳定性 (2-3 天)

#### 任务清单
1. 编写单元测试覆盖核心逻辑
2. 进行集成测试确保各组件协同工作
3. 性能测试和优化
4. 边界条件和错误情况测试
5. 用户验收测试

#### 交付物
- 稳定可靠的 macOS 应用
- 完整的测试覆盖
- 性能优化

## 详细功能规格

### 主界面
- 书籍列表视图，显示书名、作者和高亮数量
- 搜索栏用于过滤书籍
- 刷新按钮重新加载数据
- 导出按钮导出所有数据

### 书籍详情界面
- 书籍基本信息展示
- 高亮列表，按章节或顺序排列
- 每个高亮显示文本内容和创建时间
- 支持高亮的详细查看

### 数据导出
- 支持导出为 JSON 格式
- 可选择导出全部或选中的书籍
- 导出文件命名规范
- 导出进度反馈

## 复用 CLI 代码策略

### 可复用组件
1. **数据模型**: Models.swift 中的结构体可直接复用
2. **数据库访问逻辑**: SQLiteHelpers.swift 中的函数可封装为服务
3. **数据处理逻辑**: Export.swift 和 MainFlow.swift 中的部分逻辑可复用
4. **文件系统工具**: FSUtils.swift 中的辅助函数

### 需要重新实现的部分
1. **命令行参数解析**: 替换为 SwiftUI 界面交互
2. **输出处理**: 替换为 UI 展示和文件保存对话框
3. **错误处理**: 替换为 UI 反馈机制

## 风险评估与应对

### 技术风险
1. **数据库访问权限问题**
   - 应对: 提供清晰的错误提示和解决方案指南
   
2. **跨版本兼容性问题**
   - 应对: 采用 CLI 中已验证的动态列探测机制

3. **性能问题**
   - 应对: 实现数据分页和懒加载机制

### 设计风险
1. **UI 设计不符合 Apple 设计规范**
   - 应对: 遵循 SwiftUI 最佳实践，参考 Apple 官方示例

2. **用户体验不佳**
   - 应对: 进行用户测试，收集反馈并迭代优化

## 验收标准

### 功能验收
- [ ] 应用能够正确读取 Apple Books 数据库
- [ ] 能够展示书籍列表和高亮内容
- [ ] 支持基本的搜索和过滤功能
- [ ] 支持数据导出为 JSON 格式
- [ ] 提供良好的错误处理和用户反馈

### 性能验收
- [ ] 在大数据集下保持流畅的用户界面
- [ ] 内存使用合理，无明显泄漏
- [ ] 启动时间在可接受范围内

### 质量验收
- [ ] 代码符合 Swift 和 SwiftUI 最佳实践
- [ ] 提供必要的单元测试和集成测试
- [ ] 遵循项目的代码质量原则

## 时间规划

| 阶段 | 预估时间 | 关键交付物 |
|------|----------|------------|
| 基础架构搭建 | 1-2 天 | 可运行的应用框架 |
| 核心功能实现 | 3-5 天 | 完整的功能实现 |
| UI/UX 优化 | 2-3 天 | 优化的用户界面 |
| 测试与稳定性 | 2-3 天 | 稳定的产品质量 |
| **总计** | **8-13 天** | **MVP 产品** |

## 后续扩展计划

1. **Notion 集成**: 在 MVP 基础上集成 Notion API 同步功能
2. **更多导出格式**: 支持 Markdown、CSV 等格式导出
3. **高级过滤功能**: 按时间、颜色、是否有笔记等条件过滤
4. **云同步**: 支持 iCloud 或其他云服务同步配置和数据
5. **visionOS 版本**: 为 Apple Vision Pro 开发专门版本