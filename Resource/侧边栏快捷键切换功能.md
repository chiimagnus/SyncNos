# 侧边栏快捷键切换功能

## 功能概述

SyncNos 应用实现了自定义侧边栏切换快捷键功能，允许用户通过键盘快捷键快速显示/隐藏书籍列表侧边栏，提升工作效率。

## 快捷键

- **快捷键**: `⌘ + \`
- **功能**: 在显示侧边栏和仅显示详情页之间切换

## 技术实现

### 架构设计

采用 SwiftUI 环境变量模式进行状态管理，实现解耦合的组件通信：

#### 1. 环境变量定义

```swift
private struct SidebarVisibilityKey: EnvironmentKey {
    static let defaultValue: Binding<NavigationSplitViewVisibility> = .constant(.all)
}

extension EnvironmentValues {
    var sidebarVisibility: Binding<NavigationSplitViewVisibility> {
        get { self[SidebarVisibilityKey.self] }
        set { self[SidebarVisibilityKey.self] = newValue }
    }
}
```

#### 2. 状态管理

在 App 级别集中管理侧边栏状态：

```swift
@main
struct SyncNosApp: App {
    @State private var columnVisibility = NavigationSplitViewVisibility.all

    var body: some Scene {
        WindowGroup {
            BooksListView()
                .environment(\.sidebarVisibility, $columnVisibility)
        }
        .commands {
            CommandGroup(replacing: .sidebar) {
                Button {
                    columnVisibility = columnVisibility == .all ? .detailOnly : .all
                } label: {
                    Label("Toggle Sidebar", systemImage: "sidebar.left")
                }
                .keyboardShortcut("\\", modifiers: .command)
            }
        }
    }
}
```

#### 3. 视图集成

```swift
struct BooksListView: View {
    @Environment(\.sidebarVisibility) private var columnVisibility

    var body: some View {
        NavigationSplitView(columnVisibility: columnVisibility) {
            // 侧边栏内容
        } detail: {
            // 详情内容
        }
    }
}
```

## 设计原则

### 单一数据源
- 侧边栏状态仅在 App 级别管理
- 避免多处状态同步问题

### SwiftUI 原生模式
- 使用环境变量进行依赖注入
- 遵循 SwiftUI 数据流设计哲学

### 解耦合架构
- View 组件不需要知道状态切换逻辑
- 通过绑定实现响应式更新

## 与系统默认的区别

- **系统默认**: `⌘ + ⌥ + S` (macOS NavigationSplitView 自动提供)
- **自定义**: `⌘ + \` (应用级替换，优先级更高)

自定义快捷键会覆盖系统默认行为，提供更便捷的用户体验。

## 兼容性

- **最低支持版本**: macOS 13.0
- **推荐版本**: macOS 14.0+
- **SwiftUI**: 支持 `NavigationSplitView` 的 `columnVisibility` 参数

## 扩展建议

如需添加更多快捷键，可以：

1. 在 `CommandGroup` 中添加更多 `Button`
2. 使用不同的键盘快捷键组合
3. 实现更复杂的状态切换逻辑

---

*最后更新: 2025年9月24日*
